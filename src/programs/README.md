# Solana Programs

This directory contains the frontend integration for Solana programs used in Domin8.

## Structure

```
programs/
└── domin8/
    ├── domin8_prgm.json    # IDL (Interface Definition Language)
    ├── domin8_prgm.ts      # TypeScript types (auto-generated by Anchor)
    └── index.ts            # Main exports
```

## Usage

### Basic Program Access

```typescript
import { Domin8PrgmIDL, DOMIN8_PROGRAM_ID, type Domin8Prgm } from '@/programs/domin8';
import { Program, AnchorProvider, BN } from '@coral-xyz/anchor';

// Create program instance
const program = new Program<Domin8Prgm>(Domin8PrgmIDL, provider);

// Call instructions
const tx = await program.methods
  .placeBet(new BN(100000000)) // 0.1 SOL
  .accounts({
    player: wallet.publicKey,
    systemProgram: SystemProgram.programId,
  })
  .rpc();
```

### Available Exports

```typescript
import {
  // IDL and Program ID
  Domin8PrgmIDL,           // The full IDL for creating Program instances
  DOMIN8_PROGRAM_ID,       // The deployed program's public key

  // Types
  Domin8Prgm,              // Main program type
  GameConfig,              // Game configuration account
  GameCounter,             // Round counter account
  GameRound,               // Active game round account
  BetEntry,                // Individual bet record
  GameStatus,              // Enum: Idle | Waiting | AwaitingWinnerRandomness | Finished
  GameDurationConfig,      // Duration configuration struct
} from '@/programs/domin8';
```

### Type-Safe Instruction Calls

Anchor provides full type safety:

```typescript
// ✅ Type-safe - TypeScript knows the exact parameters
await program.methods
  .placeBet(new BN(amount))
  .accounts({
    player: publicKey,
    systemProgram: SystemProgram.programId,
  })
  .rpc();

// ❌ Type error - wrong parameter type
await program.methods
  .placeBet(123) // Error: Expected BN, got number
  .rpc();
```

### Account Fetching

```typescript
// Fetch accounts with full type safety
const gameConfig = await program.account.gameConfig.fetch(configPda);
console.log(gameConfig.authority.toString());
console.log(gameConfig.minBetLamports.toNumber());

// Subscribe to account changes
const listener = program.account.gameRound.subscribe(
  gameRoundPda,
  (account) => {
    console.log('Game round updated:', account);
  }
);
```

## Updating

When the smart contract changes:

1. **Rebuild the program**: `anchor build` (in project root)
2. **Copy new files**:
   ```bash
   cp target/idl/domin8_prgm.json src/programs/domin8/
   cp target/types/domin8_prgm.ts src/programs/domin8/
   ```
3. **Restart dev server**: `bun run dev`

## Benefits

✅ **Type Safety**: Full TypeScript support for all instructions and accounts
✅ **Auto-completion**: IDE knows all available methods and their parameters
✅ **Error Prevention**: Catch mistakes at compile-time, not runtime
✅ **Clean Imports**: One place to import everything program-related
✅ **Version Control**: IDL and types tracked in git for consistency

## See Also

- [Anchor Documentation](https://www.anchor-lang.com/)
- [Solana Program Library](https://spl.solana.com/)
- Main hook: `src/hooks/useGameContract.ts`
